# ğŸ›’ ë¬´ì‹ ì‚¬ íŒë§¤ì ì •ë³´ ìˆ˜ì§‘ í”„ë¡œì íŠ¸

> ì¡°ì‚¬ì—…ê³„ìš© ë¬´ì‹ ì‚¬ íŒë§¤ì ì •ë³´ í¬ë¡¤ë§ & ê²€ìƒ‰ ì‹œìŠ¤í…œ

---

## ğŸ“œ ê³¼ê±° ë²„ì „ íˆìŠ¤í† ë¦¬

### ğŸš€ ì´ˆê¸° ê°œë°œ ì—¬ì • (v0.9 ~ v2.1)

> **ì¿ íŒ¡ (v0.9~v1.1) â†’ IP ì°¨ë‹¨ â†’ ë¬´ì‹ ì‚¬ (v2.0~v2.1)**

| ë²„ì „ | í•µì‹¬ ë³€ê²½ | ì„±ê³¼ | ë¬¸ì œì  |
|------|----------|------|--------|
| **v0.9** | ë™ê¸°ì‹ + CDP ì—°ê²° | MVP ì™„ì„± | 5ê±´ë‹¹ 50ì´ˆ, ë´‡ íƒì§€ |
| **v1.0** | ë¹„ë™ê¸° ì „í™˜ + Semaphore | **10ë°° ì†ë„ ê°œì„ ** | CSV íŒŒì¼ ì¶©ëŒ |
| **v1.1** | SQLite + Batch Insert | ì•ˆì •ì„± í™•ë³´ | **ì¿ íŒ¡ IP ì°¨ë‹¨** |
| **v1.2** | Django + Celery + Redis | ë¶„ì‚° ì²˜ë¦¬ ê²€ì¦ | ì˜¤ë²„ì—”ì§€ë‹ˆì–´ë§ |
| **v2.0** | ë¬´ì‹ ì‚¬ ì „í™˜ + OpenSearch | í•œê¸€ ê²€ìƒ‰ ì§€ì› | ë™ì  í´ë˜ìŠ¤ëª… ì´ìŠˆ |
| **v2.1** | FastAPI + ì›¹ í”„ë¡ íŠ¸ì—”ë“œ | ê²€ìƒ‰ ì„œë¹„ìŠ¤ ì™„ì„± | Playwright ëŠë¦¼ |

#### í•µì‹¬ ê¸°ìˆ ì  í•´ê²°

| ë¬¸ì œ | í•´ê²°ì±… |
|------|--------|
| ë´‡ íƒì§€ | Chrome CDP ì—°ê²° (ì‚¬ìš©ì ë¸Œë¼ìš°ì €ì— ê¸°ìƒ) |
| ë™ì  í´ë˜ìŠ¤ëª… | Meta Tag + XPath ìƒëŒ€ ìœ„ì¹˜ í™œìš© |
| íŒŒì¼ ì¶©ëŒ | CSV â†’ SQLite â†’ OpenSearch ì§„í™” |
| ë¹„ë™ê¸° I/O | `asyncio.Lock()`, `as_completed()` |

#### êµí›ˆ

> âœ… **ì†ë„**: ë™ê¸° â†’ ë¹„ë™ê¸°ë¡œ 10ë°° ê°œì„   
> âœ… **ì•ˆì •ì„±**: íŒŒì¼ â†’ DB â†’ ê²€ìƒ‰ì—”ì§„ìœ¼ë¡œ ì§„í™”  
> âŒ **ë³µì¡ë„**: Celery, Kafka ë“± ê³¼ë„í•œ ì¸í”„ë¼ â†’ v3ì—ì„œ ê²½ëŸ‰í™”

---

### Week 1-3: ì¸í”„ë¼ í•™ìŠµ (Airflow, Kafka)

### Week 1: ë°±ì—”ë“œ + ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§ ê¸°ì´ˆ

| êµ¬í˜„ ë‚´ìš© | ë°°ìš´ ì  |
|-----------|---------|
| SQLAlchemy ORM | SQL Injection ë°©ì§€, DB ì¶”ìƒí™” |
| ë“€ì–¼ ì €ì¥ íŒ¨í„´ | PostgreSQL(ì›ë³¸) + OpenSearch(ê²€ìƒ‰) ë™ì‹œ ì €ì¥ |
| Redis ìºì‹± | Cache-Aside íŒ¨í„´, TTL ì„¤ì • |
| FastAPI CRUD | REST API ì„¤ê³„, Pydantic ê²€ì¦ |
| Docker Compose | ë©€í‹° ì»¨í…Œì´ë„ˆ ì¸í”„ë¼ êµ¬ì¶• |

**êµí›ˆ**: ë“€ì–¼ ì €ì¥ ì‹œ **ë°ì´í„° ì •í•©ì„±** ê´€ë¦¬ê°€ ì–´ë ¤ì›€ â†’ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ ë˜ëŠ” ë©”ì‹œì§€ í í•„ìš”

---

### Week 2: Airflow ì›Œí¬í”Œë¡œìš° ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜

| êµ¬í˜„ ë‚´ìš© | ë°°ìš´ ì  |
|-----------|---------|
| DAG ìŠ¤ì¼€ì¤„ë§ | cron í‘œí˜„ì‹, `catchup=False` |
| XCom ë°ì´í„° ì „ë‹¬ | Task ê°„ í†µì‹ , 48KB í¬ê¸° ì œí•œ ëŒ€ì‘ |
| ì»¤ìŠ¤í…€ Docker ì´ë¯¸ì§€ | Playwright í¬í•¨ Airflow ì´ë¯¸ì§€ ë¹Œë“œ |
| ì¬ì‹œë„ ì „ëµ | ì§€ìˆ˜ ë°±ì˜¤í”„ (Exponential Backoff) |

**êµí›ˆ**: AirflowëŠ” **ë³µì¡í•œ ì›Œí¬í”Œë¡œìš°**ì— ì í•©í•˜ì§€ë§Œ, ë‹¨ìˆœ ìŠ¤í¬ë¦½íŠ¸ì—ëŠ” **ì˜¤ë²„ì—”ì§€ë‹ˆì–´ë§**

---

### Week 3: Kafka ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°

| êµ¬í˜„ ë‚´ìš© | ë°°ìš´ ì  |
|-----------|---------|
| Producer/Consumer | ë©”ì‹œì§€ ë°œí–‰/ì†Œë¹„, acks ì˜µì…˜ |
| Consumer Group | íŒŒí‹°ì…˜ ë¶„ë°°, ë³‘ë ¬ ì²˜ë¦¬ |
| DLQ (Dead Letter Queue) | ì‹¤íŒ¨ ë©”ì‹œì§€ ê²©ë¦¬ ë° ì¬ì²˜ë¦¬ |
| Docker ë„¤íŠ¸ì›Œí¬ | external ë„¤íŠ¸ì›Œí¬, ì»¨í…Œì´ë„ˆ ê°„ í†µì‹  |

**êµí›ˆ**: KafkaëŠ” **ëŒ€ê·œëª¨ ë¶„ì‚° ì‹œìŠ¤í…œ**ì— í•„ìˆ˜ì§€ë§Œ, ì†ŒëŸ‰ ë°ì´í„°ì—ëŠ” **ë³µì¡ë„ë§Œ ì¦ê°€**

---

### v1~v2 ìµœì¢… ë°˜ì„±

> âŒ Playwright ë¸Œë¼ìš°ì € ìë™í™” â†’ **ìƒí’ˆ 10ê°œ ìˆ˜ì§‘ì— 1ë¶„ ì´ìƒ ì†Œìš”**  
> âŒ Kafka, Airflow, K8s ë“± ê³¼ë„í•œ ì¸í”„ë¼ â†’ **ê´€ë¦¬ ë³µì¡ë„ í­ì¦**  
> âœ… í•™ìŠµ ëª©í‘œëŠ” ë‹¬ì„±í–ˆìœ¼ë‚˜, **ì‹¤ìš©ì„± ë¶€ì¡±**ìœ¼ë¡œ v3ì—ì„œ ê²½ëŸ‰í™” ê²°ì •

---

## ğŸš€ ìƒˆë¡œìš´ ë°©í–¥ (v4) - ì•ˆì „ & ì‹¤ì‹œê°„ í•˜ì´ë¸Œë¦¬ë“œ í¬ë¡¤ëŸ¬

### í•µì‹¬ ëª©í‘œ
1. **ì•ˆì •ì„± (Stability)**: Rate Limit, User-Agent ë¡œí…Œì´ì…˜, 429 ì—ëŸ¬ í•¸ë“¤ë§
2. **ë°ì´í„° ë³´ì¡´ (Persistence)**: 1ê±´ë§ˆë‹¤ ì¦‰ì‹œ ì €ì¥(JSONL), ì¤‘ë‹¨ ì‹œ ì¬ê°œ ê°€ëŠ¥
3. **ì‹¤ì‹œê°„ì„± (Real-time)**: ìˆ˜ì§‘ ì¦‰ì‹œ OpenSearch ì ì¬ ë° ê²€ìƒ‰ ê°€ëŠ¥
4. **í™•ì¥ì„± (Scalability)**: ìƒí’ˆ ëª©ë¡ API + Next.js ë°ì´í„° íŒŒì‹± (v3 ê³„ìŠ¹)

---

## ğŸ”„ v4 ì‹¤ì‹œê°„ íŒŒì´í”„ë¼ì¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Crawler] src/v4_safe_crawler.py         â”‚
â”‚ 1. ìƒí’ˆ ëª©ë¡ API í˜¸ì¶œ (Batch 60)         â”‚
â”‚ 2. ìƒì„¸ í˜ì´ì§€ HTML íŒŒì‹± (__NEXT_DATA__) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ (1ê±´ë§ˆë‹¤ ì‹¤ì‹œê°„ ì „ì†¡)
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Disk] ì ì§„ì  ì €ì¥   â”‚      â”‚ [OpenSearch]         â”‚
â”‚ data/*.jsonl (ë°±ì—…)  â”‚      â”‚ musinsa_products     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚ (ì‹¤ì‹œê°„ ê²€ìƒ‰)
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [API Server]         â”‚      â”‚ [Frontend]           â”‚
â”‚ FastAPI (Port 8000)  â”‚ â—€â”€â”€â”€ â”‚ index.html           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš¡ v3 vs v4 ë¹„êµ

| ê¸°ëŠ¥ | v3 (Fast) | **v4 (Safe & Real-time)** |
|------|-----------|---------------------------|
| **ì†ë„** | ë§¤ìš° ë¹ ë¦„ (ì œí•œ ì—†ìŒ) | **ì•ˆì „ ì†ë„ (1~2ì´ˆ/ê±´)** |
| **ì°¨ë‹¨ ìœ„í—˜** | ë†’ìŒ (Rate Limit ë¯¸ì¤€ìˆ˜) | **ë‚®ìŒ (ëœë¤ ë”œë ˆì´, UAíšŒí”¼)** |
| **ë°ì´í„° ì €ì¥** | ì™„ë£Œ í›„ ì¼ê´„ ì €ì¥ | **1ê±´ë§ˆë‹¤ ì‹¤ì‹œê°„ ì €ì¥ (JSONL)** |
| **ê²€ìƒ‰ ì—°ë™** | ìˆ˜ë™ ì ì¬ í•„ìš” | **ìë™/ì‹¤ì‹œê°„ ì ì¬** |
| **ì¬ê°œ ê¸°ëŠ¥** | ì—†ìŒ (ì²˜ìŒë¶€í„° ë‹¤ì‹œ) | **ìˆìŒ (ì¤‘ë‹¨ ì§€ì ë¶€í„°)** |

---

## ğŸ› ï¸ ì‹¤í–‰ ë°©ë²•

### 1. ì‚¬ì „ ì¤€ë¹„ (ì¸í”„ë¼)
```bash
# Docker ì‹¤í–‰ (OpenSearch, Redis)
docker-compose up -d

# ì¸ë±ìŠ¤ ì´ˆê¸°í™” (ìµœì´ˆ 1íšŒ)
python src/init_opensearch.py
```

### 2. ê²€ìƒ‰ ì„œë¹„ìŠ¤ ì‹¤í–‰
```bash
# í„°ë¯¸ë„ A: API ì„œë²„
python src/api_server.py
```

### 3. í¬ë¡¤ëŸ¬ ì‹¤í–‰
```bash
# í„°ë¯¸ë„ B: í¬ë¡¤ëŸ¬ (100ê°œ ìˆ˜ì§‘)
python src/v4_safe_crawler.py íŒ¨ë”© 100
```
> í¬ë¡¤ëŸ¬ê°€ ì‹¤í–‰ë˜ëŠ” ë™ì•ˆ **ì¦‰ì‹œ ê²€ìƒ‰**ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤!

### 4. ì ‘ì†
- **ì›¹ ê²€ìƒ‰ UI**: `frontend/index.html` (ë¸Œë¼ìš°ì €ë¡œ ì—´ê¸°)
- **Swagger UI**: [http://localhost:8000/docs](http://localhost:8000/docs)
- **OpenSearch Dashboards**: [http://localhost:5601](http://localhost:5601)

---

## ğŸ“ í•µì‹¬ íŒŒì¼

| íŒŒì¼ | ì„¤ëª… | ë¹„ê³  |
|------|------|------|
| `src/v4_safe_crawler.py` | ğŸ›¡ï¸ **í•µì‹¬ í¬ë¡¤ëŸ¬** (ì•ˆì „, ì¬ê°œ, ì‹¤ì‹œê°„) | Main |
| `src/api_server.py` | ğŸ” ê²€ìƒ‰ API (FastAPI) | Server |
| `src/init_opensearch.py` | âš™ï¸ ì¸ë±ìŠ¤/ë¶„ì„ê¸° ì„¤ì • | Utils |
| `frontend/index.html` | ğŸ–¥ï¸ ê²€ìƒ‰ ì›¹ UI | Client |
| `data/crawl_progress_*.jsonl` | ğŸ’¾ ì‹¤ì‹œê°„ ë°±ì—… ë°ì´í„° | Data |

---

## ğŸ“Œ ê°œë°œ ê¸°ë¡

- **2025.11.22** - í”„ë¡œì íŠ¸ ì‹œì‘ (Playwright ê¸°ë°˜)
- **2025.12.19** - v1.2 OpenSearch í†µí•©
- **2026.01.10** - í´ë” êµ¬ì¡° ë¦¬íŒ©í† ë§
- **2026.01.27** - ğŸš€ **v3 í•˜ì´ë¸Œë¦¬ë“œ í¬ë¡¤ëŸ¬ ê°œë°œ** (API + HTML íŒŒì‹±)
- **2026.01.28** - ğŸ›¡ï¸ **v4 ì•ˆì „/ì‹¤ì‹œê°„ í¬ë¡¤ëŸ¬ & íŒŒì´í”„ë¼ì¸ êµ¬ì¶•**